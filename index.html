<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Schr√∂dinger's Stack: A Feline RPG</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=JetBrains+Mono:wght@400;700&display=swap');

        :root {
            --bg-color: #1a1b26;
            --term-color: rgba(30, 30, 46, 0.9);
            --text-color: #a9b1d6;
            --accent-color: #7aa2f7; /* Cat Eye Blue */
            --highlight-color: #e0af68; /* Goldfish Orange */
            --danger-color: #f7768e; /* Error Red */
            --magic-color: #bb9af7; /* Chaos Purple */
            --font-ui: 'Fredoka', sans-serif; /* Cute Rounded Font */
            --font-code: 'JetBrains Mono', monospace;
        }

        * { box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-code);
            font-size: 1.1rem;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        #bg-canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 0;
            opacity: 0.6;
            pointer-events: none;
        }

        /* Fluid Animations */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }

        @keyframes jelly {
            0% { transform: scale(1, 1); }
            30% { transform: scale(1.25, 0.75); }
            40% { transform: scale(0.75, 1.25); }
            50% { transform: scale(1.15, 0.85); }
            65% { transform: scale(0.95, 1.05); }
            75% { transform: scale(1.05, 0.95); }
            100% { transform: scale(1, 1); }
        }

        .shake-screen { animation: jelly 0.5s ease-in-out; }

        /* HUD */
        #hud {
            background-color: var(--term-color);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            font-family: var(--font-ui);
            font-weight: 600;
            z-index: 10;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .stat-box { display: flex; gap: 20px; }
        .val-hp { color: var(--danger-color); }
        .val-mp { color: var(--accent-color); }
        #location-display { color: var(--highlight-color); letter-spacing: 1px; }

        /* Terminal Log */
        #terminal {
            flex-grow: 1;
            padding: 25px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            scroll-behavior: smooth;
            z-index: 1;
        }

        .log-entry { 
            opacity: 0; animation: fadeIn 0.4s ease-out forwards; 
            line-height: 1.6;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .typewriter {
            display: inline-block;
            overflow: hidden;
            border-right: .15em solid orange; 
            white-space: nowrap;
            margin: 0;
            letter-spacing: .05em; 
            animation: blink-caret .75s step-end infinite;
        }
        @keyframes blink-caret { from, to { border-color: transparent } 50% { border-color: orange; } }

        .msg-narrator { color: #c0caf5; font-family: var(--font-ui); font-size: 1.2rem; }
        .msg-player { color: var(--accent-color); font-weight: bold; background: rgba(122, 162, 247, 0.1); padding: 8px 12px; border-radius: 8px; border-left: 4px solid var(--accent-color); }
        .msg-npc { color: var(--highlight-color); font-family: var(--font-ui); font-style: italic; }
        .msg-danger { color: var(--danger-color); font-weight: bold; }
        .msg-magic { color: var(--magic-color); }
        .msg-system { color: #9ece6a; font-family: var(--font-code); font-size: 0.9rem; opacity: 0.8; }

        /* Controls */
        #controls {
            background-color: var(--term-color);
            backdrop-filter: blur(15px);
            border-top: 2px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            z-index: 10;
        }

        #input-line { display: flex; gap: 10px; margin-top: 15px; }
        #cmd-input {
            flex-grow: 1; background: rgba(0, 0, 0, 0.3); border: 2px solid #414868; color: #fff;
            padding: 12px; font-family: var(--font-code); border-radius: 12px; outline: none; transition: border-color 0.2s;
        }
        #cmd-input:focus { border-color: var(--accent-color); }
        
        #send-btn {
            background: var(--accent-color); color: #1a1b26; border: none;
            padding: 0 25px; border-radius: 12px; cursor: pointer; font-family: var(--font-ui); font-weight: bold;
            transition: transform 0.1s;
        }
        #send-btn:active { transform: scale(0.9); }

        #quick-actions { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .btn {
            background: #24283b;
            color: #c0caf5; border: 2px solid #414868; padding: 15px 5px; border-radius: 15px;
            font-size: 1rem; font-family: var(--font-ui); font-weight: 600; cursor: pointer;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Bouncy transition */
            box-shadow: 0 4px 0 #16161e;
        }
        .btn:hover { transform: translateY(-2px); background: #2f3549; border-color: var(--accent-color); }
        .btn:active { transform: translateY(2px); box-shadow: 0 0 0 #16161e; }
        
        .btn-combat { display: none; background: #3b2424; border-color: #f7768e; color: #ff9e9e; }
        
        @media (min-width: 768px) {
            #hud, #terminal, #controls { width: 800px; margin: 0 auto; border-left: 2px solid #414868; border-right: 2px solid #414868; }
            #terminal { height: 65vh; }
            #quick-actions { grid-template-columns: repeat(6, 1fr); }
        }
    </style>
</head>
<body>

    <canvas id="bg-canvas"></canvas>

    <div id="hud">
        <div class="stat-box">
            <div><span class="stat-label">‚ù§Ô∏è Lives</span> <span id="hp-val" class="val-hp">9/9</span></div>
            <div><span class="stat-label">üß∂ Yarn</span> <span id="mp-val" class="val-mp">5/5</span></div>
        </div>
        <div id="location-display">Booting...</div>
    </div>

    <div id="terminal"></div>

    <div id="controls">
        <div id="quick-actions">
            <button class="btn expl-btn" onclick="submitBtn('north')">‚¨ÜÔ∏è Up</button>
            <button class="btn expl-btn" onclick="submitBtn('south')">‚¨áÔ∏è Down</button>
            <button class="btn expl-btn" onclick="submitBtn('west')">‚¨ÖÔ∏è Left</button>
            <button class="btn expl-btn" onclick="submitBtn('east')">‚û°Ô∏è Right</button>
            <button class="btn expl-btn" onclick="submitBtn('look')">üëÄ Sniff</button>
            <button class="btn expl-btn" onclick="submitBtn('interact')">üêæ Paw</button>
            
            <button class="btn btn-combat" onclick="submitBtn('scratch')">üòº Scratch</button>
            <button class="btn btn-combat" onclick="submitBtn('hiss')">üôÄ Hiss</button>
            <button class="btn btn-combat" onclick="submitBtn('nap')">üí§ Nap</button>
            <button class="btn btn-combat" onclick="submitBtn('zoom')">üí® Zoom</button>
        </div>
        <div id="input-line">
            <input type="text" id="cmd-input" placeholder="What will you do?" autocomplete="off">
            <button id="send-btn" onclick="submitCommand()">GO</button>
        </div>
    </div>

    <script>
        // --- UTILS ---
        function submitBtn(cmd) { if(window.engine) window.engine.handleInput(cmd); }
        function submitCommand() { const i = document.getElementById('cmd-input'); if(window.engine) window.engine.handleInput(i.value); i.value=""; i.focus(); }
        document.getElementById('cmd-input').addEventListener('keypress', e => { if(e.key==='Enter') submitCommand(); });

        // --- VISUALS ---
        const canvas = document.getElementById('bg-canvas');
        let ctx = null; if(canvas) ctx = canvas.getContext('2d');
        let width, height, particles = [];

        function resize() { if(!canvas) return; width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; }
        
        class Particle {
            constructor() { 
                this.x = Math.random()*width; this.y = Math.random()*height; 
                this.size = Math.random()*15+10; this.speedY = Math.random()*0.5+0.2; this.speedX = Math.random()*0.4-0.2;
                this.opacity = Math.random()*0.3+0.1;
                this.char = ["üêæ", "üêü", "0", "1", "üß∂"][Math.floor(Math.random()*5)]; 
            }
            update() { 
                this.y -= this.speedY; this.x += this.speedX;
                if(this.y < -20){ this.y=height; this.x=Math.random()*width; } 
            }
            draw() { 
                if(!ctx) return;
                ctx.fillStyle=`rgba(169, 177, 214, ${this.opacity})`; 
                ctx.font=`${this.size}px serif`; 
                ctx.fillText(this.char, this.x, this.y); 
            }
        }
        function initParticles() { particles=[]; for(let i=0; i<40; i++) particles.push(new Particle()); }
        function animate() { if(!ctx) return; ctx.clearRect(0,0,width,height); particles.forEach(p=>{p.update();p.draw();}); requestAnimationFrame(animate); }
        if(canvas) { window.addEventListener('resize', resize); resize(); initParticles(); animate(); }

        // --- GAME DATA ---
        const GameState = {
            mode: "INTRO",
            player: {
                name: "Stray Variable", breed: null,
                hp: 9, maxHp: 9, yarn: 5, maxYarn: 5,
                scratch: 3, purr: 2, chaos: 1, 
                inventory: ["Collar"], location: "hub"
            },
            combat: { target: null },
            dialogue: { npc: null, node: "start" }
        };

        const Breeds = {
            "VOID": { name: "üêà‚Äç‚¨õ Void Cat", desc: "One with the shadows. High Chaos.", bonus: { chaos: 3, scratch: 1 } },
            "ORANGE": { name: "üêà Orange Tabby", desc: "One brain cell. High Scratch.", bonus: { scratch: 3, purr: -1 } },
            "CALICO": { name: "üêÜ Calico", desc: "Lucky & Loved. High Purr (Defense).", bonus: { purr: 3, hp: 2 } }
        };

        const World = {
            "hub": { name: "üè† The Desktop", desc: "A giant, glowing monitor screen. It's warm here. To the NORTH: The Cloud. SOUTH: The Recycle Bin.", exits: {"north":"cloud","south":"bin"}, npc: "Prof. Meow" },
            "cloud": { name: "‚òÅÔ∏è The Cloud", desc: "Fluffy white data drifts everywhere. Looks comfortable to sleep on.", exits: {"south":"hub", "north":"firewall"}, enemies: ["Bug"] },
            "firewall": { name: "üî• The Firewall", desc: "A burning wall of red code.", exits: {"south":"cloud"}, npc: "The Compiler" },
            "bin": { name: "üóëÔ∏è Recycle Bin", desc: "Smells like old fish and deleted memories.", exits: {"north":"hub"}, enemies: ["Glitch Mouse"] }
        };

        const Bestiary = {
            "Bug": { hp: 5, att: 2, desc: "ü™≤ A literal bug. Buzzing annoyingly." },
            "Glitch Mouse": { hp: 8, att: 3, desc: "üê≠ A mouse made of static. Hard to catch!" },
            "The Compiler": { hp: 30, att: 5, boss: true, desc: "ü§ñ A strict robot who hates fuzzy logic." }
        };

        const NPCs = {
            "Prof. Meow": { name: "üéì Prof. Meow", dialogue: { "start": { text: "Mrrp? You look lost, little variable.", options: { "1": { text: "Where am I?", next: "where" }, "2": { text: "Feed me.", next: "feed" } } }, "where": { text: "Schr√∂dinger's Stack. We are both dead and alive here.", options: { "1": { text: "Oh.", next: "start" } } }, "feed": { text: "*Prof. Meow spawns a virtual tuna.*", options: { "1": { text: "Nom.", next: "start" } } } } },
            "The Compiler": { name: "ü§ñ The Compiler", dialogue: ["SYNTAX ERROR. CAT NOT FOUND."], hostile: true }
        };

        const Engine = {
            init: function() {
                this.typewrite("Initializing Schr√∂dinger's Stack...", "system");
                setTimeout(() => {
                    this.log("<br>You open your eyes. You have paws.", "narrator");
                    this.log("You are a Stray Variable, lost in the code.", "narrator");
                    this.log("Choose your form:", "system");
                    this.log("1. üêà‚Äç‚¨õ VOID CAT (Sneaky)", "msg-magic");
                    this.log("2. üêà ORANGE TABBY (Strong)", "danger");
                    this.log("3. üêÜ CALICO (Lucky)", "msg-npc");
                    GameState.mode = "INTRO";
                }, 1000);
            },

            typewrite: function(text, type) {
                const term = document.getElementById('terminal');
                if(!term) return;
                const entry = document.createElement('div');
                entry.className = `log-entry msg-${type}`;
                entry.innerHTML = text;
                term.appendChild(entry);
                term.scrollTop = term.scrollHeight;
            },

            log: function(text, type="narrator") {
                this.typewrite(text, type);
            },

            handleInput: function(cmd) {
                cmd = cmd.toLowerCase().trim();
                if(GameState.mode === "INTRO") { this.intro(cmd); return; }
                if(GameState.mode === "COMBAT") { this.combat(cmd); return; }
                if(GameState.mode === "DIALOGUE") { this.dialogue(cmd); return; }
                this.explore(cmd);
            },

            intro: function(cmd) {
                let sel = null;
                if(cmd.includes("1") || cmd.includes("void")) sel = "VOID";
                else if(cmd.includes("2") || cmd.includes("orange")) sel = "ORANGE";
                else if(cmd.includes("3") || cmd.includes("calico")) sel = "CALICO";

                if(sel) {
                    const b = Breeds[sel];
                    GameState.player.breed = sel;
                    Object.assign(GameState.player, b.bonus);
                    GameState.player.hp = GameState.player.maxHp + (b.bonus.hp||0);
                    this.log(`<br>‚ú® You are a <strong>${b.name}</strong>.`, "system");
                    setTimeout(() => {
                        this.log("Professor Meow is waiting for you.", "narrator");
                        GameState.mode = "EXPLORE";
                        this.updateHUD();
                        this.explore("look");
                    }, 1000);
                } else this.log("Choose 1, 2, or 3.", "danger");
            },

            explore: function(cmd) {
                const loc = World[GameState.player.location];
                if(["n","north"].includes(cmd) && loc.exits.north) this.move(loc.exits.north);
                else if(["s","south"].includes(cmd) && loc.exits.south) this.move(loc.exits.south);
                else if(["w","west"].includes(cmd) && loc.exits.west) this.move(loc.exits.west);
                else if(["e","east"].includes(cmd) && loc.exits.east) this.move(loc.exits.east);
                else if(["look","l","sniff"].includes(cmd)) {
                    this.log(`<br><strong>${loc.name}</strong>`, "system");
                    this.log(loc.desc, "narrator");
                    if(loc.npc) this.log(`üê± <strong>${NPCs[loc.npc].name}</strong> is here.`, "msg-npc");
                }
                else if(["paw","interact"].includes(cmd)) {
                    this.log("You bat at it with your paw. *bap bap*", "msg-player");
                }
                else if(["talk","meow"].includes(cmd)) {
                    if(loc.npc) {
                        const npc = NPCs[loc.npc];
                        if(npc.hostile) this.startCombat(loc.npc);
                        else this.showDialogue(npc, "start");
                    } else this.log("Meow? (No one answers.)", "narrator");
                }
                else this.log("You chase your tail. (Unknown command)", "system");
                this.updateHUD();
            },

            move: function(dest) {
                GameState.player.location = dest;
                this.log("Trot... trot... trot...", "system");
                this.explore("look");
                if(World[dest].enemies && Math.random() < 0.4) {
                    this.startCombat(World[dest].enemies[0]);
                }
            },

            startCombat: function(name) {
                GameState.mode = "COMBAT";
                const t = Bestiary[name];
                GameState.combat.target = {...t, name: name, currentHp: t.hp};
                this.log(`<br>üö® <strong>${name}</strong> appears!`, "danger");
                this.log(`<em>${t.desc}</em>`, "narrator");
                this.toggleControls(true);
            },

            combat: function(cmd) {
                const e = GameState.combat.target;
                if(cmd.includes("scratch")) {
                    const dmg = GameState.player.scratch;
                    e.currentHp -= dmg;
                    this.log(`üòº You scratch! <strong>${dmg}</strong> dmg!`, "msg-player");
                } else if (cmd.includes("hiss")) {
                    this.log(`üôÄ You hiss! The enemy is startled.`, "msg-magic");
                } else if (cmd.includes("nap")) {
                    this.log(`üí§ You take a nap. +2 HP.`, "msg-magic");
                    GameState.player.hp = Math.min(GameState.player.maxHp, GameState.player.hp + 2);
                } else if (cmd.includes("zoom")) {
                    if(Math.random()>0.5) { this.log("üí® You got the zoomies and escaped!", "system"); this.endCombat(); return; }
                    else this.log("üö´ You slipped on the floor!", "danger");
                }
                
                if(e.currentHp <= 0) {
                    this.log("üéâ The enemy crashed! Victory!", "system");
                    this.endCombat();
                } else {
                    this.enemyTurn();
                }
                this.updateHUD();
            },

            enemyTurn: function() {
                setTimeout(() => {
                    const dmg = GameState.combat.target.att;
                    GameState.player.hp -= dmg;
                    document.body.classList.add('shake-screen');
                    setTimeout(()=>document.body.classList.remove('shake-screen'), 500);
                    this.log(`üí• Enemy hits you! -${dmg} HP.`, "danger");
                    if(GameState.player.hp <= 0) this.log("üíÄ OUT OF LIVES. Refresh to respawn.", "danger");
                    this.updateHUD();
                }, 800);
            },

            endCombat: function() {
                GameState.mode = "EXPLORE";
                this.toggleControls(false);
            },

            dialogue: function(cmd) {
                const npc = GameState.dialogue.npc;
                const node = npc.dialogue[GameState.dialogue.node];
                if(node.options[cmd]) this.showDialogue(npc, node.options[cmd].next);
                else if(cmd.includes("back")) { GameState.mode = "EXPLORE"; this.log("You trot away.", "narrator"); }
            },

            showDialogue: function(npc, key) {
                GameState.mode = "DIALOGUE";
                GameState.dialogue = { npc: npc, node: key };
                const node = npc.dialogue[key];
                this.log(`<br><strong>${npc.name}:</strong> "${node.text}"`, "msg-npc");
                for(let k in node.options) this.log(`${k}. ${node.options[k].text}`, "msg-player");
            },

            toggleControls: function(combat) {
                document.querySelectorAll('.expl-btn').forEach(b => b.style.display = combat ? 'none' : 'block');
                document.querySelectorAll('.btn-combat').forEach(b => b.style.display = combat ? 'block' : 'none');
            },

            updateHUD: function() {
                document.getElementById('hp-val').innerText = `${GameState.player.hp}/${GameState.player.maxHp}`;
                document.getElementById('mp-val').innerText = `${GameState.player.yarn}/${GameState.player.maxYarn}`;
                document.getElementById('location-display').innerText = World[GameState.player.location].name;
            }
        };

        window.onload = () => Engine.init();
    </script>
</body>
</html>